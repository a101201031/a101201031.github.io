---
title: "Serverless framework with typescript"
excerpt: "Serverless frameworkë¥¼ ì‚¬ìš©í•˜ì—¬ nodejs ë°±ì—”ë“œ êµ¬ì„±í•˜ê¸°"

categories:
  - Serverless-nodejs

permalink: /serverless-nodejs/Serverless framework with typescript/

toc: true
toc_sticky: true

date: 2024-01-30
last_modified_at: 2024-01-30
---

# Serverless Framework

Serverless FrameworkëŠ” ì„œë²„ë¦¬ìŠ¤ ì»´í“¨íŒ… ì•„í‚¤í…ì²˜ë¥¼ ìœ„í•œ ì˜¤í”ˆ ì†ŒìŠ¤ ì†Œí”„íŠ¸ì›¨ì–´ì´ë‹¤. ì´ í”„ë ˆì„ì›Œí¬ëŠ” ê°œë°œìë“¤ì´ ì„œë²„ë¦¬ìŠ¤ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‰½ê³  ë¹ ë¥´ê²Œ êµ¬ì¶•, ë°°í¬ ë° ê´€ë¦¬í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤€ë‹¤.
Serverless Frameworkë¥¼ ì‚¬ìš©í•˜ë©´ ë³µì¡í•œ ì¸í”„ë¼ ê´€ë¦¬ ì—†ì´ë„ ì„œë²„ë¦¬ìŠ¤ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë¹ ë¥´ê²Œ êµ¬ì¶•í•˜ê³ , ìœ ì—°í•˜ê²Œ í™•ì¥í•  ìˆ˜ ìˆì–´ ê°œë°œìë“¤ ì‚¬ì´ì—ì„œ ì¸ê¸°ê°€ ë†’ë‹¤.

## íŠ¹ì§•

- **ë‹¤ì–‘í•œ í´ë¼ìš°ë“œ ì œê³µ ì—…ì²´ ì§€ì›**: AWS (Amazon Web Services), Azure, Google Cloud Platform, IBM Cloud ë“±ê³¼ ê°™ì€ ì—¬ëŸ¬ í´ë¼ìš°ë“œ ì œê³µ ì—…ì²´ë¥¼ ì§€ì›. ì´ë¥¼ í†µí•´ ê°œë°œìë“¤ì€ ë‹¤ì–‘í•œ í´ë¼ìš°ë“œ í™˜ê²½ì—ì„œ ì„œë²„ë¦¬ìŠ¤ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‰½ê²Œ ë°°í¬í•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤.

- **Infrastructure as Code (IaC)**: Serverless FrameworkëŠ” ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì²˜ë¥¼ ì½”ë“œë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤. serverless.yml íŒŒì¼ì„ í†µí•´ ì„œë²„ë¦¬ìŠ¤ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ êµ¬ì„± ìš”ì†Œë¥¼ ì •ì˜í•˜ê³ , ì´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ìë™ìœ¼ë¡œ í´ë¼ìš°ë“œ ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤.

- **í”ŒëŸ¬ê·¸ì¸ ì‹œìŠ¤í…œ**: ë‹¤ì–‘í•œ í”ŒëŸ¬ê·¸ì¸ì„ í†µí•´ ê¸°ëŠ¥ì„ í™•ì¥í•  ìˆ˜ ìˆë‹¤. ì´ë¥¼ í†µí•´ ê°œë°œìëŠ” í•„ìš”ì— ë”°ë¼ ë§ì¶¤í˜• ê¸°ëŠ¥ì„ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤.

- **ì´ë²¤íŠ¸ ì£¼ë„ ì•„í‚¤í…ì²˜**: Serverless FrameworkëŠ” ì´ë²¤íŠ¸ ì£¼ë„ ì•„í‚¤í…ì²˜ë¥¼ ì§€ì›í•œë‹¤. ì´ëŠ” íŠ¹ì • ì´ë²¤íŠ¸(ì˜ˆ: HTTP ìš”ì²­, íŒŒì¼ ì—…ë¡œë“œ ë“±)ì— ë°˜ì‘í•˜ì—¬ ìë™ìœ¼ë¡œ í•¨ìˆ˜ë¥¼ ì‹¤í–‰ì‹œí‚¤ëŠ” ë°©ì‹ì„ ë§í•œë‹¤.

- **ì‰¬ìš´ ë°°í¬ ë° ê´€ë¦¬**: ëª…ë ¹ì–´ í•œ ì¤„ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë°°í¬í•˜ê±°ë‚˜ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆë‹¤. ë˜í•œ, ì„œë²„ë¦¬ìŠ¤ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ìƒíƒœë¥¼ ì‰½ê²Œ ëª¨ë‹ˆí„°ë§í•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤.

- **ë¹„ìš© íš¨ìœ¨ì„±**: ì„œë²„ë¦¬ìŠ¤ ì•„í‚¤í…ì²˜ë¥¼ ì‚¬ìš©í•¨ìœ¼ë¡œì¨ ì‹¤ì œë¡œ ì½”ë“œê°€ ì‹¤í–‰ë  ë•Œë§Œ ë¹„ìš©ì´ ë°œìƒí•œë‹¤. ì´ëŠ” ìœ íœ´ ìƒíƒœì—ì„œëŠ” ë¹„ìš©ì´ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•˜ë©°, íŠ¹íˆ ë³€ë™ì ì¸ íŠ¸ë˜í”½ íŒ¨í„´ì„ ê°€ì§„ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì´ì ì´ ìˆë‹¤.

- **ê°œë°œì ê²½í—˜ ê°œì„ **: ê°œë°œìëŠ” ì„œë²„ ê´€ë¦¬ì— ëŒ€í•œ ë¶€ë‹´ì„ ëœê³ , ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œì™€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ê°œë°œì— ì§‘ì¤‘í•  ìˆ˜ ìˆë‹¤.


## í”„ë¡œì íŠ¸ ë§Œë“¤ê¸°


[ì„œë²„ë¦¬ìŠ¤ ê³µì‹ ë¬¸ì„œ][serverless-getting-started]ë¥¼ ë³´ë©´ `npm install -g serverless`ë¼ê³  ë‚˜ì™€ìˆì§€ë§Œ ë‚˜ëŠ” globalë¡œ ì„¤ì¹˜í•˜ì—¬ ê´€ë¦¬í•˜ëŠ” ê²ƒì„ í˜ë“¤ì–´í•˜ë‹ˆ npxë¥¼ ì‚¬ìš©í•´ í”„ë¡œì íŠ¸ë¥¼ ë§Œë“¤ê²ƒì´ë‹¤.

`npx serverless` ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ë©´ ì¹œì ˆí•˜ê²Œ ëŒ€í™”í˜• ì¸í„°í˜ì´ìŠ¤ë¡œ êµ¬ì„±ì„ ë„ì™€ì¤€ë‹¤.

[serverless-getting-started]: https://www.serverless.com/framework/docs/getting-started

```shell
> npx serverless

Creating a new serverless project

? What do you want to make? (Use arrow keys)
â¯ AWS - Node.js - Starter
  AWS - Node.js - HTTP API
  AWS - Node.js - Scheduled Task
  AWS - Node.js - SQS Worker
  AWS - Node.js - Express API
  AWS - Node.js - Express API with DynamoDB
  AWS - Python - Starter
  AWS - Python - HTTP API
  AWS - Python - Scheduled Task
  AWS - Python - SQS Worker
  AWS - Python - Flask API
  AWS - Python - Flask API with DynamoDB
  Other

? What do you want to make? AWS - Node.js - HTTP API

? What do you want to call this project? serverless-playground

âœ” Project successfully created in serverless-playground folder

? Register or Login to Serverless Framework No

? Do you want to deploy now? No
```

ë‚˜ëŠ” AWS - Node.js - HTTP API í…œí”Œë¦¿ìœ¼ë¡œ ì„¤ì •í–ˆê³  serverless framework ë¡œê·¸ì¸/ê°€ì…ì€ ì•ˆí–ˆìœ¼ë©° ë°°í¬ë„ í•˜ì§€ ì•Šì•˜ë‹¤.

ì—¬ê¸°ê¹Œì§€ ì™„ë£Œë˜ì—ˆë‹¤ë©´ ì´ë ‡ê²Œ í”„ë¡œì íŠ¸ êµ¬ì¡°ê°€ ì¡í ê²ƒì´ë‹¤.

```shell
.
â”œâ”€â”€ .gitignore
â”œâ”€â”€ README.md
â”œâ”€â”€ index.js
â””â”€â”€ serverless.yml
```


### AWS ì„¤ì •

[ì„œë²„ë¦¬ìŠ¤ ê³µì‹ ë¬¸ì„œ][serverless-getting-started]ë¥¼ ì°¸ê³ í•´ aws ì„¤ì •ì„ í•œë‹¤.

[serverless-aws-credentials]: https://www.serverless.com/framework/docs/providers/aws/guide/credentials/

### nodejs í™˜ê²½ ì„¤ì •

#### íŒ¨í‚¤ì§€ ì„¤ì¹˜

ì´ì œ nodejs ê°œë°œí™˜ê²½ì„ ì„¤ì •í•´ë³´ì. ë‚˜ëŠ” íŒ¨í‚¤ì§€ ë§¤ë‹ˆì €ë¡œ yarnì„ ì‚¬ìš©í•˜ë‹ˆ yarnì„ ê¸°ì¤€ìœ¼ë¡œ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì •í•˜ê² ë‹¤.

```shell
> yarn init
yarn init v1.22.21
question name (serverless-playground): 
question version (1.0.0): 
question description: 
question entry point (index.js): serverless.yml
question repository url: 
question author: 
question license (MIT): 
question private: 
success Saved package.json
âœ¨  Done in 12.37s.
```

í•„ìš”í•œ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•œë‹¤. íŒ¨í‚¤ì§€ ì´ë¦„ê³¼ ì„¤ëª…ì€ ì•„ë˜ ì°¸ê³ 

```shell
> yarn add [íŒ¨í‚¤ì§€ëª©ë¡]
@middy/core # ë¯¸ë“¤ì›¨ì–´ í˜•ì‹ìœ¼ë¡œ handler êµ¬ì„±
@middy/http-json-body-parser # middyì—ì„œ bodyë¥¼ jsonìœ¼ë¡œ íŒŒì‹±

> yarn add [íŒ¨í‚¤ì§€ëª©ë¡] -D
@serverless/typescript
@types/aws-lambda
@types/node
esbuild
serverless
serverless-esbuild # ë²ˆë“¤ëŸ¬. servreless-typescript-plugin ëŒ€ì‹  ì‚¬ìš©í•  ê²ƒ
serverless-offline # ë¡œì»¬ í™˜ê²½ì—ì„œ api ì„œë²„ë¥¼ ë„ìš°ê²Œ í•´ì£¼ëŠ” íŒ¨í‚¤ì§€
ts-node
tsconfig-paths # import ê²½ë¡œ ë³„ì¹­ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì„¤ì¹˜
typescript
```

#### tsconfig.json, tsconfig.paths.json ì„¤ì •

`tsconfig.path.json`ì€ ë‚˜ì¤‘ì— ìˆ˜ì •í•˜ì—¬ ì‚¬ìš©í•  ê²ƒì´ë‹ˆ ì¼ë‹¨ í‹€ë§Œ ë§Œë“¤ì–´ë†“ëŠ”ë‹¤.
tsconfigëŠ” ê°ìì˜ ì·¨í–¥(?)ì— ë§ê²Œ ì„¤ì •í•´ë„ ëœë‹¤.

```json
// tsconfig.json
{
  "extends": "./tsconfig.paths.json",
  "compilerOptions": {
    "lib": ["ESNext"],
    "moduleResolution": "node",
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "removeComments": true,
    "sourceMap": true,
    "target": "ES2020",
    "outDir": "lib",
    "strict": true,
    "allowSyntheticDefaultImports": true,
  },
  "include": ["src/**/*.ts"],
  "exclude": [
    "node_modules/**/*",
    ".serverless/**/*",
    ".webpack/**/*",
    "_warmup/**/*",
    ".vscode/**/*"
  ],
  "ts-node": {
    "require": ["tsconfig-paths/register"]
  }
}
```

```json
// tsconfig.paths.json
{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@functions": ["src/functions/index.ts"],
      "@common": ["src/common/index.ts"],
      "@utils": ["src/utils/index.ts"],
    }
  }
}
```

#### serverless.yml, functions.yml ì„¤ì •

```yml
# functions.yml
hello:
  handler: ./src/functions/hello.handler
  events:
    - httpApi:
        path: /
        method: get

```

```yml
#serverless.yml
service: serverless-playground

frameworkVersion: '3'

provider:
  name: aws
  runtime: nodejs18.x
  region: ap-northeast-2
  apiGateway:
    minimumCompressionSize: 1024
    shouldStartNameWithService: true
  environment:
    AWS_NODEJS_CONNECTION_REUSE_ENABLED: 1
    NODE_OPTIONS: --enable-source-maps --stack-trace-limit=1000

plugins: 
  - serverless-esbuild
  - serverless-offline

functions:
  - ${file(./functions.yml)}

package:
  individually: true

custom:
  esbuild:
    bundle: true
    minify: false
    sourcemap: true
    exclude: 
      - aws-sdk
    target: node18
    define:
      require.resolve: undefined
    platform: node
    concurrency: 10
    packager: yarn
  
  serverless-offline: 
    httpPort: 8000
    host: 0.0.0.0
```

- custom: í”ŒëŸ¬ê·¸ì¸ ì„¤ì • ë“± ì»¤ìŠ¤í…€ ì„¤ì •
  - esbuild: esbuild í”ŒëŸ¬ê·¸ì¸ ì„¤ì •
    - bundle: ê°€ì ¸ì˜¨ ì¢…ì†ì„±ì„ íŒŒì¼ ìì²´ì— ì¸ë¼ì¸í•˜ëŠ” ê²ƒì„ ì˜ë¯¸. ì´ í”„ë¡œì„¸ìŠ¤ëŠ” ì¬ê·€ì ì´ë¯€ë¡œ ì¢…ì† ìš”ì†Œì˜ ì¢…ì† ìš”ì†Œë„ ì¸ë¼ì¸.
    - minify: ì¶•ì†Œí•˜ì—¬ ë¹Œë“œ `fn = obj => { return obj.x }` â‡’ `fn=n=>n.x;`
    - sourcemap: source map í¬í•¨ ì—¬ë¶€
    - exclude: ë¹Œë“œì— í¬í•¨í•˜ì§€ ì•ŠìŒ
    - target: ë¹Œë“œ ê²°ê³¼ë¬¼ì˜ javascript ë²„ì „
    - define: ì „ì—­ ì‹ë³„ìë¥¼ ìƒìˆ˜ í‘œí˜„ì‹ìœ¼ë¡œ ëŒ€ì²´. ì—¬ê¸°ì„œëŠ” require.resolveì˜ ì‚¬ìš©ì´ ì—ëŸ¬ê°€ ë°œìƒí•˜ì§€ ì•Šë„ë¡ ì„¤ì •
    - platform: ë¹Œë“œ ê²°ê³¼ë¬¼ì´ ì‚¬ìš©ë  í”Œë«í¼ (ê¸°ë³¸ì€ browser)
    - concurrency: í•œ ë²ˆì— ì‹¤í–‰í•  ë™ì‹œ ì••ì¶• ë° ë²ˆë“¤ ì‘ì—… ìˆ˜
    - external: ë²ˆë“¤ë§ ì‹œ ë¬¸ì œ ë°œìƒì„ ë§‰ê¸° ìœ„í•´ ë²ˆë“¤ë§ ì œì™¸
    - packager: external ì¢…ì†ì„± í•´ê²° íŒ¨í‚¤ì§€ ë§¤ë‹ˆì €
  - serverless-offline
    - httpPort: í˜¸ìŠ¤íŒ…í•  í¬íŠ¸
    - host: í˜¸ìŠ¤íŒ…í•  ip ì£¼ì†Œ
    - prefix: ëª¨ë“  api ê²½ë¡œì— ì¶”ê°€í•  ì ‘ë‘ì‚¬
- provider: ì„œë¹„ìŠ¤ ê³µê¸‰ì ì„¤ì • (aws, gcf, azure ë“±)
  - minimumCompressionSize: ìš”ì²­ ì‘ë‹µ ë³¸ë¬¸ ì••ì¶•í•  ìµœì†Œ ì‚¬ì´ì¦ˆ(ì´ìƒì´ë©´ ì••ì¶•)
  - shouldStartNameWithService: functionì„ ì €ì¥í•  ë•Œ ì„œë¹„ìŠ¤ëª…ì„ í¬í•¨í•´ ì €ì¥
- environment: í™˜ê²½ ë³€ìˆ˜
  - AWS_NODEJS_CONNECTION_REUSE_ENABLED: aws nodejsì—ì„œ tcp ì—°ê²° ì¬ì‚¬ìš©
  - NODE_OPTIONS: nodejs ìì²´ ì‹¤í–‰ ì˜µì…˜
    - --enable-source-maps: ìŠ¤íƒ ì¶”ì²™ì— source mapì„ ì‚¬ìš©
    - --stack-trace-limit=1000: ìŠ¤íƒ ì¶”ì ì˜ í•œê³„ì¹˜ ì ìš©
- package: ë°°í¬ íŒ¨í‚¤ì§€ ì„¤ì •
  - individually: í•¨ìˆ˜ë¥¼ ê°œë³„ì ìœ¼ë¡œ íŒ¨í‚¤ì§•

### hello í•¨ìˆ˜ ë§Œë“¤ê¸°

í”„ë¡œì íŠ¸ ë£¨íŠ¸ì—ì„œ src/functions/hello.ts íŒŒì¼ì„ ë§Œë“¤ê³  ì•„ë˜ì²˜ëŸ¼ ë‚´ìš©ì„ ì‘ì„±í•´ì¤€ë‹¤.

```typescript
import middy from '@middy/core';

const formatJSONResponse = (
  response: Record<string, unknown> = {},
  statusCode = 200,
) => ({
  statusCode,
  body: JSON.stringify(response),
});

const hello = async () => {
  return formatJSONResponse({ message: 'hello' });
};

export const handler = middy(hello);

```

ì´ì œ functions.ymlì˜ ë‚´ìš©ì„ ë³´ë©° ë¹„êµí•´ë³´ì.

```yml
hello: # í•¨ìˆ˜ ì´ë¦„
  handler: ./src/functions/hello.handler # í•¨ìˆ˜ ê²½ë¡œ. ë§ˆì§€ë§‰ì€ íŒŒì¼ëª….í•¨ìˆ˜ëª…
  events:
    - httpApi:
        path: / # ìš”ì²­ url ê²½ë¡œ
        method: get # ìš”ì²­ HTTP Method
```

`/` urlë¡œ ë“¤ì–´ì˜¤ëŠ” get ìš”ì²­ì„ hello íŒŒì¼ì˜ handler í•¨ìˆ˜ë¡œ ì‘ë‹µí•˜ê² ë‹¤ëŠ” ëœ»ì´ë‹¤.

ì´ì œ ì‹¤í–‰í•´ë³´ì. `package.json`ì— ì´ ë‚´ìš©ì„ ì¶”ê°€í•˜ê³  `yarn start:dev` ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•œë‹¤.

```json
// ...
  "scripts": {
    "start:dev": "yarn serverless offline --noPrependStageInUrl"
  },
// ...
```

```shell
Starting Offline at stage dev (ap-northeast-2)

Offline [http for lambda] listening on http://0.0.0.0:3002
Function names exposed for local invocation by aws-sdk:
           * hello: serverless-playground-dev-hello

   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚                                                                       â”‚
   â”‚   GET | http://0.0.0.0:8000/                                          â”‚
   â”‚   POST | http://0.0.0.0:8000/2015-03-31/functions/hello/invocations   â”‚
   â”‚                                                                       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Server ready: http://0.0.0.0:8000 ğŸš€
```

ì´ë ‡ê²Œ ëœ¬ë‹¤ë©´ ì¼ë‹¨ serverless-offline ì‹¤í–‰ì€ ì„±ê³µ.

`curl -X 'GET' 'http://localhost:8000/'` ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ë©´ `{"message":"hello"}`ê°€ ì¶œë ¥ëœë‹¤!

ë‹¤ìŒ í¬ìŠ¤íŒ…ì—ì„œëŠ” dynamoDBë¥¼ ì‚¬ìš©í•œ CRUD êµ¬í˜„, ì²´ê³„í™”ëœ êµ¬ì¡° í™•ë¦½ì— ëŒ€í•´ ì‘ì„±í•  ì˜ˆì •ì´ë‹¤.
